/* 
* jCountdown 1.3 jQuery Plugin
* Copyright 2011 Tom Ellis http://www.webmuse.co.uk
* Licensed under MIT License
* See http://www.webmuse.co.uk/license/
*/
(function(k){k.fn.countdown=function(r){var y={date:new Date,updateTime:1E3,htmlTemplate:'%{d} <span class="cd-time">days</span> %{h} <span class="cd-time">hours</span> %{m} <span class="cd-time">mins</span> %{s} <span class="cd-time">sec</span>',minus:false,onChange:null,onComplete:null,onResume:null,onPause:null,leadingZero:false,offset:null,direction:"down"},z=[].slice,l=Math.floor,d={},s=/(%\{d\}|%\{h\}|%\{m\}|%\{s\})/g,n=/%\{d\}/,o=/%\{h\}/,p=/%\{m\}/,q=/%\{s\}/,v=false,t,w=function(){var c,
b,a,h,i,e,f;c="";var g=this.data("jcdSettings");if(g){c=g.htmlTemplate;b=g.offset==null?new Date:u(g.offset);a=new Date(g.date);h=(g.direction=="down"?a.getTime()-b.getTime():b.getTime()-a.getTime())/864E5;i=l(h);e=(h-i)*24;h=l(e);f=l((e-h)*60);e=l(((e-h)*60-f)*60);if(g.leadingZero){if(i<10)i="0"+i;if(h<10)h="0"+h;if(f<10)f="0"+f;if(e<10)e="0"+e}if(g.direction==="down"&&(b<=a||g.minus))c=c.replace(n,i).replace(o,h).replace(p,f).replace(q,e);else if(d.direction==="up"&&(a<=b||d.minus))c=c.replace(n,
i).replace(o,h).replace(p,f).replace(q,e);else{c=c.replace(s,"00");g.complete=true}this.html(c);this.trigger("change",[g.timer]);if(g.complete){this.trigger("complete.jcountdown");clearInterval(g.timer)}}},u=function(c){c=c||0;var b=0,a=new Date;c*=36E5;b=a.getTime()- -a.getTimezoneOffset()/60*36E5;dateMS=a.setTime(b+c);return new Date(dateMS)},x={init:function(c){k.extend(d,y,c);t=d.htmlTemplate;return this.each(function(){var b=k(this),a={},h=d.offset==null?new Date:u(d.offset),i=new Date(d.date),
e=(d.direction=="down"?i.getTime()-h.getTime():h.getTime()-i.getTime())/864E5,f=l(e),g=(e-f)*24;e=l(g);var j=l((g-e)*60),m=l(((g-e)*60-j)*60);g="";d.onChange&&b.bind("change.jcountdown",d.onChange);d.onComplete&&b.bind("complete.jcountdown",d.onComplete);d.onPause&&b.bind("pause.jcountdown",d.onPause);d.onResume&&b.bind("resume.jcountdown",d.onResume);if(d.leadingZero){if(f<10)f="0"+f;if(e<10)e="0"+e;if(j<10)j="0"+j;if(m<10)m="0"+m}if(d.direction==="down"&&(h<=i||d.minus))g=t.replace(n,f).replace(o,
e).replace(p,j).replace(q,m);else if(d.direction==="up"&&(i<=h||d.minus))g=t.replace(n,f).replace(o,e).replace(p,j).replace(q,m);else{g=t.replace(s,"00");v=true}a.originalContent=k(this).html();a.date=d.date;a.leadingZero=d.leadingZero;a.updateTime=d.updateTime;a.direction=d.direction;a.template=d.htmlTemplate;a.htmlTemplate=d.htmlTemplate;a.minus=d.minus;a.complete=v;a.offset=d.offset;a.onChange=d.onChange;a.onComplete=d.onComplete;a.onResume=d.onResume;a.onPause=d.onPause;if(!v){h=k.proxy(w,b);
a.timer=window.setInterval(h,a.updateTime)}b.data("jcdSettings",a);b.html(g);if(a.complete){b.trigger("complete.jcountdown");clearInterval(a.timer)}})},changeSettings:function(c){return this.each(function(){var b=k(this),a,h,i,e,f,g,j,m;if(!b.data("jcdSettings"))return true;a=k.extend({},b.data("jcdSettings"),c);if(!a)return true;h=a.htmlTemplate;i=a.offset==null?new Date:u(a.offset);e=new Date(d.date);f=(a.direction=="down"?e.getTime()-i.getTime():i.getTime()-e.getTime())/864E5;g=l(f);j=(f-g)*24;
f=l(j);m=l((j-f)*60);j=l(((j-f)*60-m)*60);b.unbind(".jcountdown");clearInterval(a.timer);a.onChange&&b.bind("change.jcountdown",a.onChange);a.onComplete&&b.bind("complete.jcountdown",a.onComplete);a.onPause&&b.bind("pause.jcountdown",a.onPause);a.onResume&&b.bind("resume.jcountdown",a.onResume);if(a.direction==="down"&&(i<=e||a.minus))h.replace(n,g).replace(o,f).replace(p,m).replace(q,j);else if(d.direction==="up"&&(e<=i||d.minus))h.replace(n,g).replace(o,f).replace(p,m).replace(q,j);else{h.replace(s,
"00");a.complete=true}h=k.proxy(w,b);a.timer=window.setInterval(h,a.updateTime);b.data("jcdSettings",a);if(a.complete){b.trigger("complete.jcountdown");clearInterval(a.timer)}})},resume:function(){return this.each(function(){var c=k(this),b,a,h,i,e,f,g,j,m;a="";b=c.data("jcdSettings");if(!b)return true;h=k.proxy(w,c);a=b.htmlTemplate;i=b.offset==null?new Date:u(b.offset);e=new Date(d.date);f=(b.direction=="down"?e.getTime()-i.getTime():i.getTime()-e.getTime())/864E5;g=l(f);j=(f-g)*24;f=l(j);m=l((j-
f)*60);j=l(((j-f)*60-m)*60);if(b.direction==="down"&&(i<=e||b.minus))a=a.replace(n,g).replace(o,f).replace(p,m).replace(q,j);else if(d.direction==="up"&&(e<=i||d.minus))a=a.replace(n,g).replace(o,f).replace(p,m).replace(q,j);else{a=a.replace(s,"00");b.complete=true}b.timer=window.setInterval(h,b.updateTime);c.data("jcdSettings",b);c.trigger("resume.jcountdown");c.html(a).trigger("change.jcountdown");if(b.complete){c.trigger("complete.jcountdown");clearInterval(b.timer)}})},pause:function(){return this.each(function(){var c=
k(this),b=k.data(c[0],"jcdSettings");if(!b)return true;c.trigger("pause.jcountdown");clearInterval(b.timer)})},complete:function(){return this.each(function(){var c=k(this),b=c.data("jcdSettings");if(!b)return true;clearInterval(b.timer);b.complete=true;c.data("jcdSettings",b);c.trigger("complete.jcountdown")})},destroy:function(){return this.each(function(){var c=k(this),b;b=c.data("jcdSettings");if(!b)return true;c.unbind(".jcountdown");c.html(b.originalContent);c.removeData("jcdSettings")})},getSettings:function(){var c;
if(c=k(this[0]).data("jcdSettings"))return c}};if(x[r])return x[r].apply(this,z.call(arguments,1));else if(typeof r==="object"||!r)return x.init.apply(this,arguments);else k.error("Method "+r+" does not exist in the jCountdown Plugin")}})(jQuery);
