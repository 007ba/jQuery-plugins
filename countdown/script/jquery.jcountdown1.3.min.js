/* 
* jCountdown 1.3 jQuery Plugin
* Copyright 2011 Tom Ellis http://www.webmuse.co.uk
* Licensed under MIT License
* See http://www.webmuse.co.uk/license/
*/
(function(l){l.fn.countdown=function(r){var y={date:new Date,updateTime:1E3,htmlTemplate:'%{d} <span class="cd-time">days</span> %{h} <span class="cd-time">hours</span> %{m} <span class="cd-time">mins</span> %{s} <span class="cd-time">sec</span>',minus:false,onChange:null,onComplete:null,onResume:null,onPause:null,leadingZero:false,offset:null,direction:"down"},z=[].slice,k=Math.floor,c={},s=/(%\{d\}|%\{h\}|%\{m\}|%\{s\})/g,n=/%\{d\}/,o=/%\{h\}/,p=/%\{m\}/,q=/%\{s\}/,v=false,t,w=function(){var d,
b,a,g,i,e,h;d="";var f=this.data("jcdSettings");if(f){d=f.htmlTemplate;b=f.offset==null?new Date:u(f.offset);a=new Date(f.date);g=(f.direction=="down"?a.getTime()-b.getTime():b.getTime()-a.getTime())/864E5;i=k(g);e=(g-i)*24;g=k(e);h=k((e-g)*60);e=k(((e-g)*60-h)*60);if(f.leadingZero){if(i<10)i="0"+i;if(g<10)g="0"+g;if(h<10)h="0"+h;if(e<10)e="0"+e}if(f.direction==="down"&&(b<=a||f.minus))d=d.replace(n,i).replace(o,g).replace(p,h).replace(q,e);else if(c.direction==="up"&&(a<=b||c.minus))d=d.replace(n,
i).replace(o,g).replace(p,h).replace(q,e);else{d=d.replace(s,"00");f.complete=true}this.html(d);this.trigger("change",[f.timer]);if(f.complete){this.trigger("complete.jcountdown");clearInterval(f.timer)}}},u=function(d){d=d||0;var b=0;b=null;var a=new Date;d*=36E5;b=a.getTime()- -a.getTimezoneOffset()/60*36E5;dateMS=a.setTime(b+d);b=new Date(dateMS);b.setMilliseconds((new Date).getMilliseconds());return b},x={init:function(d){l.extend(c,y,d);t=c.htmlTemplate;return this.each(function(){var b=l(this),
a={},g=c.offset==null?new Date:u(c.offset),i=new Date(c.date),e=(c.direction=="down"?i.getTime()-g.getTime():g.getTime()-i.getTime())/864E5,h=k(e),f=(e-h)*24;e=k(f);var j=k((f-e)*60),m=k(((f-e)*60-j)*60);f="";c.onChange&&b.bind("change.jcountdown",c.onChange);c.onComplete&&b.bind("complete.jcountdown",c.onComplete);c.onPause&&b.bind("pause.jcountdown",c.onPause);c.onResume&&b.bind("resume.jcountdown",c.onResume);if(c.leadingZero){if(h<10)h="0"+h;if(e<10)e="0"+e;if(j<10)j="0"+j;if(m<10)m="0"+m}if(c.direction===
"down"&&(g<=i||c.minus))f=t.replace(n,h).replace(o,e).replace(p,j).replace(q,m);else if(c.direction==="up"&&(i<=g||c.minus))f=t.replace(n,h).replace(o,e).replace(p,j).replace(q,m);else{f=t.replace(s,"00");v=true}a.date=c.date;a.leadingZero=c.leadingZero;a.updateTime=c.updateTime;a.direction=c.direction;a.template=c.htmlTemplate;a.htmlTemplate=c.htmlTemplate;a.minus=c.minus;a.complete=v;a.offset=c.offset;a.onChange=c.onChange;a.onComplete=c.onComplete;a.onResume=c.onResume;a.onPause=c.onPause;if(!v){g=
l.proxy(w,b);a.timer=window.setInterval(g,a.updateTime)}b.data("jcdSettings",a);b.html(f);if(a.complete){b.trigger("complete.jcountdown");clearInterval(a.timer)}})},changeSettings:function(d){return this.each(function(){var b=l(this),a,g,i,e,h,f,j,m;if(!b.data("jcdSettings"))return true;a=l.extend({},b.data("jcdSettings"),d);if(!a)return true;g=a.htmlTemplate;i=a.offset==null?new Date:u(a.offset);e=new Date(c.date);h=(a.direction=="down"?e.getTime()-i.getTime():i.getTime()-e.getTime())/864E5;f=k(h);
j=(h-f)*24;h=k(j);m=k((j-h)*60);j=k(((j-h)*60-m)*60);b.unbind(".jcountdown");clearInterval(a.timer);a.onChange&&b.bind("change.jcountdown",a.onChange);a.onComplete&&b.bind("complete.jcountdown",a.onComplete);a.onPause&&b.bind("pause.jcountdown",a.onPause);a.onResume&&b.bind("resume.jcountdown",a.onResume);if(a.direction==="down"&&(i<=e||a.minus))g.replace(n,f).replace(o,h).replace(p,m).replace(q,j);else if(c.direction==="up"&&(e<=i||c.minus))g.replace(n,f).replace(o,h).replace(p,m).replace(q,j);else{g.replace(s,
"00");a.complete=true}g=l.proxy(w,b);a.timer=window.setInterval(g,a.updateTime);b.data("jcdSettings",a);if(a.complete){b.trigger("complete.jcountdown");clearInterval(a.timer)}})},resume:function(){return this.each(function(){var d=l(this),b,a,g,i,e,h,f,j;a="";b=d.data("jcdSettings");if(!b)return true;var m=l.proxy(w,d);a=b.htmlTemplate;g=b.offset==null?new Date:u(b.offset);i=new Date(c.date);e=(b.direction=="down"?i.getTime()-g.getTime():g.getTime()-i.getTime())/864E5;h=k(e);f=(e-h)*24;e=k(f);j=k((f-
e)*60);f=k(((f-e)*60-j)*60);if(b.direction==="down"&&(g<=i||b.minus))a=a.replace(n,h).replace(o,e).replace(p,j).replace(q,f);else if(c.direction==="up"&&(i<=g||c.minus))a=a.replace(n,h).replace(o,e).replace(p,j).replace(q,f);else{a=a.replace(s,"00");b.complete=true}b.timer=window.setInterval(m,b.updateTime);d.data("jcdSettings",b);d.trigger("resume.jcountdown");d.html(a).trigger("change.jcountdown");if(b.complete){d.trigger("complete.jcountdown");clearInterval(b.timer)}})},pause:function(){return this.each(function(){var d=
l(this),b=l.data(d[0],"jcdSettings");if(!b)return true;d.trigger("pause.jcountdown");clearInterval(b.timer)})},complete:function(){return this.each(function(){var d=l(this),b=d.data("jcdSettings");if(!b)return true;clearInterval(b.timer);b.complete=true;d.data("jcdSettings",b);d.trigger("complete.jcountdown")})},destroy:function(){return this.each(function(){var d=l(this);if(!d.data("jcdSettings"))return true;d.unbind(".jcountdown");d.removeData("jcdSettings")})},getSettings:function(){var d;if(d=
l(this[0]).data("jcdSettings"))return d}};if(x[r])return x[r].apply(this,z.call(arguments,1));else if(typeof r==="object"||!r)return x.init.apply(this,arguments);else l.error("Method "+r+" does not exist in the jCountdown Plugin")}})(jQuery);
